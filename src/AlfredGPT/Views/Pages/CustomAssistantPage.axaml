<UserControl
  x:Class="AlfredGPT.Views.Pages.CustomAssistantPage" xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:ai="clr-namespace:AlfredGPT.AI"
  xmlns:shadui="clr-namespace:ShadUI.Controls;assembly=ShadUI" xmlns:v="clr-namespace:AlfredGPT.Views"
  xmlns:vm="clr-namespace:AlfredGPT.ViewModels" x:DataType="vm:CustomAssistantPageViewModel">
  <Grid
    ColumnDefinitions="*,8,3*" RowDefinitions="Auto,*"
    RowSpacing="16">
    <Button
      Classes="Primary" Grid.Row="0"
      Grid.Column="0" HorizontalAlignment="Left"
      Command="{Binding CreateNewCustomAssistantCommand}"
      Content="{I18N {x:Static LocaleKey.CustomAssistantPage_CreateNewCustomAssistantButton_Content}}"
      ToolTip.Tip="{I18N {x:Static LocaleKey.CustomAssistantPage_CreateNewCustomAssistantButton_ToolTip}}">
      <shadui:ButtonAssist.Icon>
        <LucideIcon Kind="Plus"/>
      </shadui:ButtonAssist.Icon>
    </Button>

    <ListBox
      Grid.Row="1" Grid.Column="0"
      ItemsSource="{Binding CustomAssistants}"
      ScrollViewer.HorizontalScrollBarVisibility="Disabled"
      SelectedItem="{Binding SelectedCustomAssistant, Mode=TwoWay}">
      <ListBox.Styles>
        <Style Selector="Border">
          <Setter Property="Background" Value="{DynamicResource CardBackgroundColor}"/>
        </Style>
      </ListBox.Styles>
      <ListBox.DataTemplates>
        <DataTemplate DataType="ai:CustomAssistant">
          <DockPanel
            HorizontalSpacing="12" LastChildFill="True">
            <v:IconPresenter
              DockPanel.Dock="Left" Width="40"
              Height="40" CornerRadius="20"
              FontSize="24"
              Icon="{Binding Icon}"
              IconSize="24"/>

            <StackPanel VerticalAlignment="Center">
              <TextBlock
                FontSize="15"
                Text="{Binding Name, FallbackValue={x:Null}}"
                TextTrimming="CharacterEllipsis"
                ToolTip.Tip="{Binding $self.Text}"/>

              <TextBlock
                Classes="Muted"
                IsVisible="{Binding Description, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                MaxLines="2"
                Text="{Binding Description}"
                TextTrimming="CharacterEllipsis"
                ToolTip.Tip="{Binding $self.Text}"/>
            </StackPanel>
          </DockPanel>
        </DataTemplate>
      </ListBox.DataTemplates>
    </ListBox>

    <GridSplitter
      Grid.Row="0" Grid.RowSpan="2"
      Grid.Column="1" VerticalAlignment="Stretch"
      Background="Transparent"/>

    <StackPanel
      Grid.Row="0" Grid.Column="2"
      HorizontalAlignment="Right" Orientation="Horizontal"
      Spacing="8">
      <Button
        Classes="Primary" Height="34"
        VerticalAlignment="Center"
        shadui:ButtonAssist.ShowProgress="{Binding CheckConnectivityCommand.IsRunning}"
        Command="{Binding CheckConnectivityCommand}"
        Content="{I18N {x:Static LocaleKey.CustomAssistantPage_CheckConnectivityButton_Content}}"
        IsVisible="{Binding SelectedCustomAssistant, Converter={x:Static ObjectConverters.IsNotNull}}"
        ToolTip.Tip="{I18N {x:Static LocaleKey.CustomAssistantPage_CheckConnectivityButton_ToolTip}}">
        <shadui:ButtonAssist.Icon>
          <LucideIcon Kind="Unplug"/>
        </shadui:ButtonAssist.Icon>
      </Button>
      <Button
        Classes="Destructive" VerticalAlignment="Center"
        Command="{Binding DeleteCustomAssistantCommand}"
        Content="{I18N {x:Static LocaleKey.CustomAssistantPage_DeleteCustomAssistantButton_Content}}"
        IsVisible="{Binding SelectedCustomAssistant, Converter={x:Static ObjectConverters.IsNotNull}}"
        ToolTip.Tip="{I18N {x:Static LocaleKey.CustomAssistantPage_DeleteCustomAssistantButton_ToolTip}}">
        <shadui:ButtonAssist.Icon>
          <LucideIcon Kind="Trash2"/>
        </shadui:ButtonAssist.Icon>
      </Button>
    </StackPanel>

    <ScrollViewer
      Grid.Row="1" Grid.Column="2"
      HorizontalScrollBarVisibility="Disabled">
      <v:SettingsItemsControl
        Margin="0,0,12,0"
        ItemsSource="{Binding SelectedCustomAssistant.SettingsItems, FallbackValue={x:Null}}"/>
    </ScrollViewer>
  </Grid>
</UserControl>